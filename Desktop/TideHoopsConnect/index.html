<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tide Hoops Connect</title>
    
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="Resources/Styles/main-styles.css">
    <link rel="stylesheet" href="Resources/Styles/theme-overrides.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary d-flex align-items-center" href="#">
                <img src="Resources/Images/Tide Hoops Connect Logo.png" alt="Tide Hoops Connect" style="height: 140px; width: auto; margin-right: 25px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav ms-auto">
                    <button class="nav-link btn btn-outline-primary me-2 active" data-section="dashboard">Dashboard</button>
                    <button class="nav-link btn btn-outline-primary me-2" data-section="workouts-stats">Basketball Stats</button>
                    <button class="nav-link btn btn-outline-primary me-2" data-section="lifting">Workout Log</button>
                    <button class="nav-link btn btn-outline-primary me-2" data-section="coach">Coach View</button>
                    <!-- Login Page Feature - User Display and Logout -->
                    <div class="dropdown">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            <span id="userDisplay">User</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" style="min-width: 300px;">
                            <!-- Profile Section -->
                            <li class="dropdown-header">
                                <div class="d-flex align-items-center">
                                    <img id="profilePhoto" src="" alt="Profile" class="rounded-circle me-2" style="width: 40px; height: 40px; object-fit: cover; background-color: #f8f9fa;">
                                    <div>
                                        <div class="fw-bold" id="profileName">Loading...</div>
                                        <small class="text-muted" id="profileEmail">Loading...</small>
                                    </div>
                                </div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            
                            <!-- Profile Info -->
                            <li class="px-3 py-2">
                                <div class="row g-2">
                                    <div class="col-4"><small class="text-muted">Name:</small></div>
                                    <div class="col-8"><small id="profileFullName">-</small></div>
                                    <div class="col-4"><small class="text-muted">Email:</small></div>
                                    <div class="col-8"><small id="profileEmailDetail">-</small></div>
                                    <div class="col-4"><small class="text-muted">Position:</small></div>
                                    <div class="col-8"><small id="profilePosition">-</small></div>
                                </div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            
                            <!-- Logout -->
                            <li><button class="dropdown-item" id="logoutBtn">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </button></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container py-4">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="h3 text-white">Player Dashboard</h2>
                <div class="user-selector">
                    <div class="text-end">
                        <label for="playerSelect" class="form-label text-white mb-2 d-block">
                            <i class="bi bi-people-fill me-2"></i>View Dashboard For:
                            <small class="text-light d-block mt-1" style="font-size: 0.8rem;">
                                <i class="bi bi-arrow-down me-1"></i>Click to select different player
                            </small>
                        </label>
                        <select id="playerSelect" class="form-select form-select-lg bg-white border-primary shadow-sm" style="min-width: 200px;">
                            <option value="current">Loading players...</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="row g-3 mb-4">
                <div class="col-md-3 col-sm-6">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Total Workouts</h5>
                            <div class="display-4 text-primary" id="totalWorkouts">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">3-Point %</h5>
                            <div class="display-4 text-success" id="threePointPercentage">0%</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">2-Point %</h5>
                            <div class="display-4 text-info" id="twoPointPercentage">0%</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Free Throw %</h5>
                            <div class="display-4 text-warning" id="freeThrowPercentage">0%</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">üèÜ Official Game Leaderboard</h5>
                            <select id="leaderboardSort" class="form-select form-select-sm" style="width: auto;">
                                <option value="totalPoints">Total Points</option>
                                <option value="threes">3 Pointers</option>
                                <option value="twos">2 Points</option>
                                <option value="freeThrows">Free Throws</option>
                                <option value="assists">Assists</option>
                                <option value="rebounds">Rebounds</option>
                            </select>
                        </div>
                        <div class="card-body">
                            <div id="topShooters" class="text-center">
                                <p class="text-muted">Loading leaderboard...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Workout Frequency</h5>
                        </div>
                        <div class="card-body">
                            <div id="workoutChart" class="text-center">
                                <p class="text-muted">Workout frequency data will be displayed here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Workouts & Statistics Section -->
        <section id="workouts-stats" class="section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="h3 text-white">Basketball Statistics</h2>
                <button class="btn btn-primary" id="addEntryBtn">Add Stats</button>
            </div>

            <!-- Combined Workout & Statistics Form -->
            <div class="card mb-4" id="combinedForm" style="display: none;">
                <div class="card-header">
                    <h5 class="card-title mb-0">Log Basketball Statistics</h5>
                </div>
                <div class="card-body">
                    <form id="combinedFormElement">
                        <!-- Workout Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <label for="sessionDate" class="form-label">Date</label>
                                <input type="date" class="form-control" id="sessionDate" required>
                            </div>
                            <div class="col-md-12">
                                <label for="sessionType" class="form-label">Session Type</label>
                                <select class="form-select" id="sessionType" required>
                                    <option value="">Select Type</option>
                                    <option value="shooting">Shooting Practice</option>
                                    <option value="skills">Skills Training</option>
                                    <option value="practice">Practice Game</option>
                                    <option value="scrimmage">Scrimmage</option>
                                    <option value="game">Official Game</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label for="notes" class="form-label">Notes</label>
                                <textarea class="form-control" id="notes" rows="3" placeholder="Any additional notes about the session..."></textarea>
                            </div>
                        </div>

                        <!-- Statistics Information -->
                        <div class="row g-3 mb-4">
                            <div class="col-12">
                                <h6 class="text-success border-bottom pb-2">Basketball Statistics</h6>
                                <p class="text-muted small">Enter shooting statistics for this session (leave as 0 if not applicable)</p>
                            </div>
                            <div class="col-md-6">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label for="threePointAttempts" class="form-label">3-Point Attempts</label>
                                        <input type="number" class="form-control" id="threePointAttempts" min="0" value="0">
                                    </div>
                                    <div class="col-6">
                                        <label for="threePointMakes" class="form-label">3-Point Makes</label>
                                        <input type="number" class="form-control" id="threePointMakes" min="0" value="0">
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted" id="statsThreePointPercentage">3-Point %: 0%</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label for="twoPointAttempts" class="form-label">2-Point Attempts</label>
                                        <input type="number" class="form-control" id="twoPointAttempts" min="0" value="0">
                                    </div>
                                    <div class="col-6">
                                        <label for="twoPointMakes" class="form-label">2-Point Makes</label>
                                        <input type="number" class="form-control" id="twoPointMakes" min="0" value="0">
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted" id="statsTwoPointPercentage">2-Point %: 0%</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label for="freeThrowAttempts" class="form-label">Free Throw Attempts</label>
                                        <input type="number" class="form-control" id="freeThrowAttempts" min="0" value="0">
                                    </div>
                                    <div class="col-6">
                                        <label for="freeThrowMakes" class="form-label">Free Throw Makes</label>
                                        <input type="number" class="form-control" id="freeThrowMakes" min="0" value="0">
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="text-muted" id="statsFreeThrowPercentage">Free Throw %: 0%</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <label for="assists" class="form-label">Assists</label>
                                        <input type="number" class="form-control" id="assists" min="0" value="0">
                                    </div>
                                    <div class="col-6">
                                        <label for="rebounds" class="form-label">Rebounds</label>
                                        <input type="number" class="form-control" id="rebounds" min="0" value="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-flex gap-2 mt-3">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" class="btn btn-secondary" id="cancelCombined">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Statistics Overview Cards -->
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">3-Point Shooting</h5>
                            <div class="display-4 text-success" id="threePointStats">0/0 (0%)</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card text-center">
                        <div class="card-body">
                            <h5 class="card-title">Free Throw Shooting</h5>
                            <div class="display-4 text-info" id="freeThrowStats">0/0 (0%)</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Statistics History -->
            <div class="row g-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Statistics History</h5>
                            <div>
                                <label for="statsFilter" class="form-label mb-1 me-2">Filter by Session Type:</label>
                                <select id="statsFilter" class="form-select form-select-sm" style="width: auto;">
                                    <option value="all">All Sessions</option>
                                    <option value="shooting">Shooting Practice</option>
                                    <option value="skills">Skills Training</option>
                                    <option value="practice">Practice Game</option>
                                    <option value="scrimmage">Scrimmage</option>
                                    <option value="game">Official Game</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="statsContainer"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lifting Stats Section -->
        <section id="lifting" class="section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="h3 text-white">Workout Log</h2>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-3 col-sm-6">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Total Workouts</h5>
                            <div class="display-4 text-primary" id="liftingTotalWorkouts">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Total Volume (lbs)</h5>
                            <div class="display-4 text-success" id="liftingTotalVolume">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Avg Weight / Set</h5>
                            <div class="display-4 text-info" id="liftingAvgWeight">0</div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <h5 class="card-title">Exercises Tracked</h5>
                            <div class="display-4 text-warning" id="liftingExerciseCount">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Log Workout</h5>
                    <div>
                        <button class="btn btn-outline-primary btn-sm" id="manageExercisesBtn">Manage Exercises</button>
                    </div>
                </div>
                <div class="card-body">
                    <form id="liftingWorkoutForm">
                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Date</label>
                                <input type="date" class="form-control" id="liftingDate" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Notes</label>
                                <input type="text" class="form-control" id="liftingNotes" placeholder="Optional">
                            </div>
                        </div>

                        <div id="liftingSetsContainer" class="mb-3"></div>
                        <button type="button" class="btn btn-outline-primary" id="addSetBtn">Add Set</button>

                        <div class="d-flex gap-2 mt-3">
                            <button type="submit" class="btn btn-primary">Save Workout</button>
                            <button type="button" class="btn btn-secondary" id="clearLiftingForm">Clear</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">Workout History</h5>
                            <div class="d-flex gap-2 align-items-end">
                                <div>
                                    <label for="liftingStartDate" class="form-label mb-1 small">Start Date</label>
                                    <input type="date" id="liftingStartDate" class="form-control form-control-sm">
                                </div>
                                <div>
                                    <label for="liftingEndDate" class="form-label mb-1 small">End Date</label>
                                    <input type="date" id="liftingEndDate" class="form-control form-control-sm">
                                </div>
                                <div>
                                    <label class="form-label mb-1 small">&nbsp;</label>
                                    <button class="btn btn-primary btn-sm" id="liftingFilterBtn">Filter</button>
                                </div>
                                <div>
                                    <label class="form-label mb-1 small">&nbsp;</label>
                                    <button class="btn btn-secondary btn-sm" id="liftingClearFilterBtn">Clear</button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="liftingWorkoutHistory"></div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Progress</h5>
                        </div>
                        <div class="card-body">
                            <div id="liftingProgressChart" class="text-center">
                                <p class="text-muted">Weight progression will appear here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exercise Library Modal -->
            <div class="modal fade" id="exerciseLibraryModal" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Exercise Library</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="d-flex gap-2 mb-3">
                                <input type="text" id="exerciseName" class="form-control" placeholder="Exercise name">
                                <input type="text" id="exerciseCategory" class="form-control" placeholder="Category (e.g., Upper Body)">
                                <button class="btn btn-primary" id="addExerciseBtn">Add Exercise</button>
                            </div>
                            <div id="exerciseList"></div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Coach View Section -->
        <section id="coach" class="section">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="h3 text-white">Coach Dashboard</h2>
                        <button class="btn btn-primary" id="addPlayerBtn">Invite Player</button>
            </div>

            <div class="card mb-4" id="playerForm" style="display: none;">
                <div class="card-header">
                    <h5 class="card-title mb-0">Invite New Player</h5>
                </div>
                <div class="card-body">
                    <form id="playerFormElement">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="playerFirstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="playerFirstName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="playerLastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="playerLastName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="playerEmail" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="playerEmail" placeholder="example@crimson.ua.edu" required>
                                <div class="form-text">The email address the player will use to log in</div>
                            </div>
                            <div class="col-md-6">
                                <label for="playerPosition" class="form-label">Position</label>
                                <select class="form-select" id="playerPosition">
                                    <option value="PG">Point Guard</option>
                                    <option value="SG">Shooting Guard</option>
                                    <option value="SF">Small Forward</option>
                                    <option value="PF">Power Forward</option>
                                    <option value="C">Center</option>
                                </select>
                            </div>
                        </div>
                        <div class="alert alert-info mt-3">
                            <strong>Note:</strong> This is a testing environment. The invited player will not receive an actual email, but their information will be added to the system. When they log in with their email, they will have access to the site without needing to enter their name and position.
                        </div>
                        <div class="d-flex gap-2 mt-3">
                            <button type="submit" class="btn btn-primary">Invite Player</button>
                            <button type="button" class="btn btn-secondary" id="cancelPlayer">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card mb-4" id="editPlayerForm" style="display: none;">
                <div class="card-header">
                    <h5 class="card-title mb-0">Edit Player</h5>
                </div>
                <div class="card-body">
                    <form id="editPlayerFormElement">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="editPlayerFirstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="editPlayerFirstName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="editPlayerLastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="editPlayerLastName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="editPlayerEmail" class="form-label">Email Address</label>
                                <input type="email" class="form-control" id="editPlayerEmail" placeholder="example@crimson.ua.edu" required>
                                <div class="form-text">The email address the player will use to log in</div>
                            </div>
                            <div class="col-md-6">
                                <label for="editPlayerPosition" class="form-label">Position</label>
                                <select class="form-select" id="editPlayerPosition">
                                    <option value="PG">Point Guard</option>
                                    <option value="SG">Shooting Guard</option>
                                    <option value="SF">Small Forward</option>
                                    <option value="PF">Power Forward</option>
                                    <option value="C">Center</option>
                                </select>
                            </div>
                        </div>
                        <div class="d-flex gap-2 mt-3">
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                            <button type="button" class="btn btn-secondary" id="cancelEditPlayer">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Team Overview</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-3 col-sm-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">Total Players</h6>
                                    <div class="display-6 text-primary" id="totalPlayers">0</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">Avg 3-Point %</h6>
                                    <div class="display-6 text-success" id="teamThreePointAvg">0%</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">Avg Free Throw %</h6>
                                    <div class="display-6 text-info" id="teamFreeThrowAvg">0%</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h6 class="card-title">Total Workouts</h6>
                                    <div class="display-6 text-warning" id="teamTotalWorkouts">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Player Comparison Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">Player Comparison</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3 mb-4">
                        <div class="col-md-5">
                            <label for="comparePlayer1" class="form-label">Select First Player</label>
                            <select class="form-select" id="comparePlayer1">
                                <option value="">Choose a player...</option>
                            </select>
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <div class="text-center w-100">
                                <span class="badge bg-secondary comparison-vs">VS</span>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <label for="comparePlayer2" class="form-label">Select Second Player</label>
                            <select class="form-select" id="comparePlayer2">
                                <option value="">Choose a player...</option>
                            </select>
                        </div>
                    </div>
                    <div class="text-center mb-3">
                        <button class="btn btn-primary" id="comparePlayersBtn" disabled>Compare Players</button>
                        <button class="btn btn-secondary ms-2" id="clearComparisonBtn" style="display: none;">Clear Comparison</button>
                    </div>
                    <div id="comparisonResults" style="display: none;">
                        <!-- Comparison results will be displayed here -->
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Players</h5>
                </div>
                <div class="card-body">
                    <div id="playersContainer"></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Bootstrap 5 JS (bundle includes Popper) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Authentication Check -->
    <script>
        // Login Page Feature - Authentication Check
        document.addEventListener('DOMContentLoaded', function() {
            const isAuthenticated = localStorage.getItem('tideHoopsAuthenticated');
            const userEmail = localStorage.getItem('tideHoopsUserEmail');
            
            if (isAuthenticated !== 'true' || !userEmail) {
                // Redirect to login page if not authenticated
                window.location.href = 'login.html';
                return;
            }
            
            // Check if login is expired (24 hours)
            const loginTime = localStorage.getItem('tideHoopsLoginTime');
            if (loginTime) {
                const loginDate = new Date(loginTime);
                const now = new Date();
                const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
                
                if (hoursDiff > 24) {
                    // Clear authentication and redirect to login
                    localStorage.removeItem('tideHoopsAuthenticated');
                    localStorage.removeItem('tideHoopsUserEmail');
                    localStorage.removeItem('tideHoopsLoginTime');
                    window.location.href = 'login.html';
                    return;
                }
            }
            
            // Update user display and profile if authenticated
            const userDisplay = document.getElementById('userDisplay');
            const userEmailDisplay = document.getElementById('userEmailDisplay');
            
            // Profile elements
            const profilePhoto = document.getElementById('profilePhoto');
            const profileName = document.getElementById('profileName');
            const profileEmail = document.getElementById('profileEmail');
            const profileFullName = document.getElementById('profileFullName');
            const profileEmailDetail = document.getElementById('profileEmailDetail');
            const profilePosition = document.getElementById('profilePosition');
            
            // Fetch user data from API to get full name and profile info
            fetch(`http://localhost:5038/api/Player/email/${encodeURIComponent(userEmail)}`)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('User not found');
                })
                .then(user => {
                    // Update main dropdown button
                    if (userDisplay) {
                        userDisplay.textContent = `${user.firstName} ${user.lastName}`;
                    }
                    if (userEmailDisplay) {
                        userEmailDisplay.textContent = userEmail;
                    }
                    
                    // Update profile section
                    if (profileName) {
                        profileName.textContent = `${user.firstName} ${user.lastName}`;
                    }
                    if (profileEmail) {
                        profileEmail.textContent = user.email;
                    }
                    if (profileFullName) {
                        profileFullName.textContent = `${user.firstName} ${user.lastName}`;
                    }
                    if (profileEmailDetail) {
                        profileEmailDetail.textContent = user.email;
                    }
                    if (profilePosition) {
                        profilePosition.textContent = user.position;
                    }
                    if (profilePhoto) {
                        // Default avatar with initials
                        const initials = `${user.firstName.charAt(0)}${user.lastName.charAt(0)}`.toUpperCase();
                        profilePhoto.src = `data:image/svg+xml;base64,${btoa(`
                            <svg width="40" height="40" xmlns="http://www.w3.org/2000/svg">
                                <rect width="40" height="40" fill="#6c757d"/>
                                <text x="20" y="26" text-anchor="middle" fill="white" font-family="Arial" font-size="14" font-weight="bold">${initials}</text>
                            </svg>
                        `)}`;
                    }
                })
                .catch(error => {
                    console.error('Error fetching user data:', error);
                    // Fallback to email prefix if API call fails
                    if (userDisplay) {
                        const username = userEmail.split('@')[0];
                        userDisplay.textContent = username;
                    }
                    if (userEmailDisplay) {
                        userEmailDisplay.textContent = userEmail;
                    }
                    
                    // Set fallback profile data
                    if (profileName) profileName.textContent = 'User';
                    if (profileEmail) profileEmail.textContent = userEmail;
                    if (profileFullName) profileFullName.textContent = 'Unknown';
                    if (profileEmailDetail) profileEmailDetail.textContent = userEmail;
                    if (profilePosition) profilePosition.textContent = 'Unknown';
                });
            
        });
    </script>

    <!-- Custom JS -->
    <script src="Resources/Scripts/script.js"></script>
</body>
</html>
